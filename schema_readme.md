# Document Management System - PostgreSQL Schema

This document outlines the PostgreSQL database schema designed for the document management system. The schema supports storing documents with text content, ownership information, summaries, graph relationships, and topic/cluster information.

## Key Components

### 1. Document Storage
- **Organizations and Users**: B2B multi-tenant structure with organizations and users
- **Documents**: Core document storage with text content and metadata
- **Document Versions**: Support for version control and change history
- **Content Search**: Full-text search capabilities using PostgreSQL's GIN indexes

### 2. Relationship Modeling
- **Graph Structure**: Nodes and relationships stored in relational tables
- **Node Types**: Documents, concepts, entities, topics, etc.
- **Relationship Types**: References, contains, related_to, etc.
- **Tool Attribution**: Tracking which tool/agent created each relationship

### 3. Semantic Organization
- **Topics**: Extracted from document content or manually assigned
- **Topic Hierarchy**: Parent-child relationships between topics
- **Document Clusters**: Groups of related documents based on algorithms
- **Membership Scores**: Strength of document relationship to topics/clusters

### 4. Document Analysis
- **Summaries**: Multiple summary types per document
- **Tool Attribution**: Record of which tools/agents generated each summary
- **Confidence Scores**: Quality metrics for generated content

## Tables Overview

1. **organizations**: Tenant companies in the B2B system
2. **users**: Users belonging to organizations
3. **documents**: Core document storage with metadata
4. **document_versions**: Historical versions of documents
5. **summaries**: Document summaries with tool attribution
6. **graph_nodes**: Nodes in the document relationship graph
7. **graph_relationships**: Relationships between nodes
8. **topics**: Document topics/categories
9. **document_topics**: Junction table linking documents to topics
10. **document_clusters**: Clusters of related documents
11. **document_cluster_members**: Junction table linking documents to clusters

## Query Patterns Supported

1. **Retrieving documents by owner/organization**:
   - Find all documents owned by a specific user
   - Find all documents in an organization with pagination

2. **Traversing relationships between documents**:
   - Find directly related documents
   - Recursive queries to find document networks

3. **Finding documents by topic or cluster**:
   - Find documents with specific topics
   - Find documents within topic hierarchies
   - Find documents in clusters

4. **Querying for summaries by tool/agent**:
   - Find summaries generated by specific tools
   - Get latest summaries for documents

## Performance Features

- Appropriate indexes for common query patterns
- Full-text search indexes for document content
- JSONB indexes for flexible metadata
- Partial indexes for common filtering conditions
- Constraints and triggers for data integrity

## Schema Design Decisions

1. **Timestamps and Versioning**:
   - All tables have created_at timestamps
   - Most tables have updated_at timestamps maintained by triggers
   - Documents maintain explicit version numbers
   - Full version history stored in document_versions

2. **Graph Structure**:
   - Implemented using relational tables rather than a dedicated graph database
   - Supports non-document nodes for concepts, entities, etc.
   - Bi-directional traversal via source and target indexes

3. **Extensibility**:
   - JSONB fields for flexible metadata
   - Text arrays for keywords
   - Custom properties on nodes and relationships

4. **Data Integrity**:
   - Cascading deletes for dependent records
   - Constraint checks for valid values
   - Unique constraints for preventing duplicates
   - Foreign key constraints for referential integrity
